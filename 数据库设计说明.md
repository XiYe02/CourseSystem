# 学生选课信息管理系统数据库设计说明

## 1. 数据库概述

本数据库设计用于支持基于JavaEE的学生选课信息管理系统，采用MySQL数据库，字符集为utf8mb4，支持完整的Unicode字符集。

## 2. 数据库表结构设计

### 2.1 学生信息表 (student)

**表名**: `student`  
**用途**: 存储学生的基本信息

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 学生ID，主键 |
| student_number | VARCHAR(20) | UNIQUE, NOT NULL | 学号，唯一标识 |
| name | VARCHAR(50) | NOT NULL | 学生姓名 |
| gender | ENUM('MALE', 'FEMALE') | | 性别 |
| birth_date | DATE | | 出生日期 |
| phone | VARCHAR(20) | | 联系电话 |
| email | VARCHAR(100) | | 邮箱地址 |
| major | VARCHAR(100) | | 专业 |
| grade | INT | | 年级 |
| class_name | VARCHAR(50) | | 班级 |
| enrollment_date | DATE | | 入学日期 |
| status | ENUM('ACTIVE', 'INACTIVE', 'GRADUATED') | DEFAULT 'ACTIVE' | 学生状态 |
| created_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- `idx_student_number`: 学号索引
- `idx_major_grade`: 专业和年级复合索引

### 2.2 课程信息表 (course)

**表名**: `course`  
**用途**: 存储课程的基本信息

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 课程ID，主键 |
| course_code | VARCHAR(20) | UNIQUE, NOT NULL | 课程代码 |
| course_name | VARCHAR(100) | NOT NULL | 课程名称 |
| credits | DECIMAL(3,1) | NOT NULL | 学分 |
| hours | INT | NOT NULL | 学时 |
| course_type | ENUM('REQUIRED', 'ELECTIVE', 'PUBLIC') | NOT NULL | 课程类型 |
| department | VARCHAR(100) | | 开课院系 |
| teacher_name | VARCHAR(50) | | 授课教师 |
| teacher_title | VARCHAR(50) | | 教师职称 |
| max_students | INT | DEFAULT 100 | 最大选课人数 |
| description | TEXT | | 课程描述 |
| prerequisites | VARCHAR(500) | | 先修课程 |
| status | ENUM('ACTIVE', 'INACTIVE') | DEFAULT 'ACTIVE' | 课程状态 |
| created_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- `idx_course_code`: 课程代码索引
- `idx_course_type`: 课程类型索引
- `idx_department`: 院系索引

### 2.3 学期信息表 (semester)

**表名**: `semester`  
**用途**: 存储学期信息，支持按学期选课

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 学期ID，主键 |
| semester_code | VARCHAR(20) | UNIQUE, NOT NULL | 学期代码 |
| semester_name | VARCHAR(50) | NOT NULL | 学期名称 |
| academic_year | VARCHAR(20) | NOT NULL | 学年 |
| semester_type | ENUM('SPRING', 'SUMMER', 'AUTUMN', 'WINTER') | NOT NULL | 学期类型 |
| start_date | DATE | NOT NULL | 开始日期 |
| end_date | DATE | NOT NULL | 结束日期 |
| registration_start_date | DATE | | 选课开始日期 |
| registration_end_date | DATE | | 选课结束日期 |
| status | ENUM('UPCOMING', 'CURRENT', 'FINISHED') | DEFAULT 'UPCOMING' | 学期状态 |
| created_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- `idx_semester_code`: 学期代码索引
- `idx_academic_year`: 学年索引

### 2.4 选课信息表 (course_selection)

**表名**: `course_selection`  
**用途**: 存储学生选课信息，核心业务表

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 选课ID，主键 |
| student_id | BIGINT | NOT NULL, FOREIGN KEY | 学生ID，外键关联student表 |
| course_id | BIGINT | NOT NULL, FOREIGN KEY | 课程ID，外键关联course表 |
| semester_id | BIGINT | NOT NULL, FOREIGN KEY | 学期ID，外键关联semester表 |
| selection_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 选课时间 |
| status | ENUM('SELECTED', 'DROPPED', 'COMPLETED') | DEFAULT 'SELECTED' | 选课状态 |
| score | DECIMAL(5,2) | | 成绩 |
| grade_point | DECIMAL(3,2) | | 绩点 |
| exam_time | TIMESTAMP | | 考试时间 |
| remarks | TEXT | | 备注 |
| created_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**约束**:
- `uk_student_course_semester`: 学生、课程、学期唯一约束
- 外键约束：级联删除

**索引**:
- `idx_student_semester`: 学生和学期复合索引
- `idx_course_semester`: 课程和学期复合索引

### 2.5 用户表 (user)

**表名**: `user`  
**用途**: 存储系统用户信息，支持权限管理

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 用户ID，主键 |
| username | VARCHAR(50) | UNIQUE, NOT NULL | 用户名 |
| password | VARCHAR(255) | NOT NULL | 密码（加密后） |
| real_name | VARCHAR(50) | | 真实姓名 |
| email | VARCHAR(100) | | 邮箱 |
| phone | VARCHAR(20) | | 电话 |
| role | ENUM('ADMIN', 'TEACHER', 'STUDENT') | NOT NULL | 用户角色 |
| student_id | BIGINT | FOREIGN KEY | 关联学生ID（学生用户） |
| status | ENUM('ACTIVE', 'INACTIVE', 'LOCKED') | DEFAULT 'ACTIVE' | 用户状态 |
| last_login_time | TIMESTAMP | | 最后登录时间 |
| login_count | INT | DEFAULT 0 | 登录次数 |
| created_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- `idx_username`: 用户名索引
- `idx_role`: 角色索引

### 2.6 操作日志表 (operation_log)

**表名**: `operation_log`  
**用途**: 记录系统操作日志，支持AOP日志功能

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 日志ID，主键 |
| user_id | BIGINT | FOREIGN KEY | 操作用户ID |
| username | VARCHAR(50) | | 操作用户名 |
| operation_type | ENUM('CREATE', 'UPDATE', 'DELETE', 'SELECT', 'LOGIN', 'LOGOUT') | NOT NULL | 操作类型 |
| operation_module | VARCHAR(50) | NOT NULL | 操作模块 |
| operation_description | TEXT | | 操作描述 |
| target_type | VARCHAR(50) | | 操作对象类型 |
| target_id | BIGINT | | 操作对象ID |
| request_method | VARCHAR(10) | | 请求方法 |
| request_url | VARCHAR(500) | | 请求URL |
| request_params | TEXT | | 请求参数 |
| response_result | TEXT | | 响应结果 |
| ip_address | VARCHAR(50) | | IP地址 |
| user_agent | VARCHAR(500) | | 用户代理 |
| execution_time | BIGINT | | 执行时间（毫秒） |
| status | ENUM('SUCCESS', 'FAILURE', 'ERROR') | DEFAULT 'SUCCESS' | 操作状态 |
| error_message | TEXT | | 错误信息 |
| operation_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 操作时间 |

**索引**:
- `idx_user_id`: 用户ID索引
- `idx_operation_type`: 操作类型索引
- `idx_operation_time`: 操作时间索引
- `idx_operation_module`: 操作模块索引

### 2.7 系统配置表 (system_config)

**表名**: `system_config`  
**用途**: 存储系统配置信息

| 字段名 | 数据类型 | 约束 | 说明 |
|--------|----------|------|------|
| id | BIGINT | PRIMARY KEY, AUTO_INCREMENT | 配置ID，主键 |
| config_key | VARCHAR(100) | UNIQUE, NOT NULL | 配置键 |
| config_value | TEXT | | 配置值 |
| config_description | VARCHAR(500) | | 配置描述 |
| config_type | ENUM('STRING', 'NUMBER', 'BOOLEAN', 'JSON') | DEFAULT 'STRING' | 配置类型 |
| is_system | BOOLEAN | DEFAULT FALSE | 是否系统配置 |
| created_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP | 创建时间 |
| updated_time | TIMESTAMP | DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP | 更新时间 |

**索引**:
- `idx_config_key`: 配置键索引

## 3. 数据库视图设计

### 3.1 学生选课统计视图 (v_student_course_summary)

**用途**: 提供学生选课情况的统计信息，便于生成选课汇总报告

**包含字段**:
- 学生基本信息（ID、学号、姓名、专业、年级）
- 学期信息
- 选课统计（总课程数、已完成学分、总学分、平均成绩）

### 3.2 课程选课统计视图 (v_course_selection_summary)

**用途**: 提供课程选课情况的统计信息，便于课程管理

**包含字段**:
- 课程基本信息（ID、课程代码、课程名称、学分、教师）
- 学期信息
- 选课统计（已选人数、最大人数、剩余名额、平均成绩）

## 4. 数据库设计特点

### 4.1 支持的核心功能

1. **学生信息管理**: 完整的学生信息CRUD操作
2. **选课管理**: 按学期进行选课，支持选课状态管理
3. **权限管理**: 基于角色的用户权限控制
4. **日志记录**: 详细的操作日志，支持AOP切面记录
5. **数据统计**: 通过视图提供选课统计功能

### 4.2 技术特性

1. **数据完整性**: 使用外键约束保证数据一致性
2. **性能优化**: 合理的索引设计提高查询性能
3. **扩展性**: 预留字段支持功能扩展
4. **安全性**: 密码加密存储，操作日志记录
5. **缓存支持**: 表结构设计考虑Redis缓存需求

### 4.3 业务规则

1. **选课约束**: 学生在同一学期不能重复选择同一课程
2. **状态管理**: 学生、课程、选课都有状态字段进行生命周期管理
3. **时间控制**: 学期表包含选课时间范围控制
4. **容量限制**: 课程表包含最大选课人数限制

## 5. 初始数据说明

数据库包含以下初始数据：

1. **学期数据**: 2024-2025学年两个学期
2. **学生数据**: 4名测试学生
3. **课程数据**: 5门测试课程（必修课、选修课、公共课）
4. **用户数据**: 管理员、教师、学生用户账号
5. **选课数据**: 部分学生的选课记录
6. **系统配置**: 基本的系统配置参数

## 6. 使用建议

1. **部署前**: 确保MySQL版本支持utf8mb4字符集
2. **性能优化**: 根据实际数据量调整索引策略
3. **备份策略**: 建议定期备份，特别是选课高峰期
4. **监控**: 关注operation_log表的增长，定期清理历史日志
5. **安全**: 定期更新用户密码，监控异常登录

## 7. 扩展建议

1. **分表策略**: 当operation_log表数据量过大时，可考虑按时间分表
2. **读写分离**: 可配置MySQL主从复制，读写分离提高性能
3. **缓存策略**: 课程信息、学期信息等相对静态的数据适合缓存
4. **归档策略**: 历史学期数据可考虑归档到历史表